<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BeliveHome AI Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{--bg:#f6f7f9;--card:#fff;--text:#111;--muted:#6b7280;--brand:#22c55e}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:860px;margin:36px auto;padding:0 16px}
    .card{background:var(--card);border-radius:16px;box-shadow:0 6px 24px rgba(0,0,0,.06);padding:20px}
    .topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    h1{margin:0;font-size:24px}
    .lang{display:flex;gap:8px;align-items:center}
    select{padding:6px 10px;border:1px solid #e5e7eb;border-radius:8px;background:#fff}
    .chat{display:flex;flex-direction:column;gap:10px;margin:12px 0 14px;max-height:60vh;overflow:auto;padding-right:6px}
    .bubble{padding:12px 14px;border-radius:14px;max-width:85%;line-height:1.5;white-space:pre-wrap}
    .user{align-self:flex-end;background:#e8f8ee}
    .bot{align-self:flex-start;background:#f3f4f6}
    .row{display:flex;gap:10px}
    .ipt{flex:1;padding:12px 14px;border:1px solid #e5e7eb;border-radius:12px;outline:none;font-size:16px}
    .btn{background:var(--brand);color:#fff;border:0;padding:0 18px;border-radius:12px;font-size:16px;cursor:pointer}
    .btn[disabled]{opacity:.6;cursor:not-allowed}
    .muted{color:var(--muted);font-size:13px;margin-top:8px}
    .typing{display:inline-flex;gap:4px;align-items:center}
    .typing span{width:6px;height:6px;border-radius:999px;background:#9ca3af;animation:blink 1.2s infinite}
    .typing span:nth-child(2){animation-delay:.2s}.typing span:nth-child(3){animation-delay:.4s}
    @keyframes blink{0%,80%,100%{opacity:.2}40%{opacity:1}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="topbar">
        <h1 id="title">ü§ñ BeliveHome AI Assistant</h1>
        <div class="lang">
          <label for="langSel" id="langLabel">Language</label>
          <select id="langSel">
            <option value="en">English</option>
            <option value="zh">‰∏≠Êñá</option>
          </select>
        </div>
      </div>

      <div id="chat" class="chat"></div>

      <div class="row">
        <input id="q" class="ipt" placeholder="Type your question‚Ä¶" />
        <button id="send" class="btn">Send</button>
      </div>
      <div class="muted" id="hint">Note: Do not enter sensitive information. AI responses are for reference only.</div>
    </div>
  </div>

<script>
/** === Configuration === **/
const API_URL = 'https://belivehome-ai.vercel.app/api/chat'; // Ëã•‰∏éÂêéÁ´ØÂêåÂüüÔºåÂèØÊîπ‰∏∫ '/api/chat'

/** === i18n strings === **/
const STR = {
  en: {
    title: "ü§ñ BeliveHome AI Assistant",
    language: "Language",
    placeholder: "Type your question‚Ä¶",
    send: "Send",
    hint: "Note: Do not enter sensitive information. AI responses are for reference only.",
    hello: "Hello! I'm BeliveHome's AI assistant. I can help with renovation, waterproofing, and material selection.",
    thinking: "AI is thinking‚Ä¶",
    netErr: msg => "‚ùå Network error: " + msg,
    quota: "‚ùå Insufficient quota: please add billing or use a key with credits.",
    sysPrompt: "You are BeliveHome's renovation & waterproofing consultant. Be professional and friendly. Keep answers concise with steps or checklists when helpful."
  },
  zh: {
    title: "ü§ñ BeliveHome AI Âä©Êâã",
    language: "ËØ≠Ë®Ä",
    placeholder: "ËØ∑ËæìÂÖ•ÈóÆÈ¢ò‚Ä¶",
    send: "ÂèëÈÄÅ",
    hint: "ÊèêÁ§∫ÔºöËØ∑ÂãøËæìÂÖ•ÈöêÁßÅ‰ø°ÊÅØ„ÄÇAI ÂõûÁ≠î‰ªÖ‰æõÂèÇËÄÉ„ÄÇ",
    hello: "‰Ω†Â•ΩÔºÅÊàëÊòØ BeliveHome ÁöÑ AI Âä©ÊâãÔºåÂèØÂõûÁ≠îË£Ö‰øÆ„ÄÅÈò≤Ê∞¥„ÄÅÊùêÊñôÈÄâÊã©Á≠âÈóÆÈ¢ò„ÄÇ",
    thinking: "Ê≠£Âú®ÊÄùËÄÉ‚Ä¶",
    netErr: msg => "‚ùå ÁΩëÁªúÈîôËØØÔºö" + msg,
    quota: "‚ùå ‰ΩôÈ¢ù‰∏çË∂≥ÔºöËØ∑Âú® OpenAI Billing ÈáåÂÖÖÂÄºÊàñÊõ¥Êç¢ÊúâÈ¢ùÂ∫¶ÁöÑÂØÜÈí•„ÄÇ",
    sysPrompt: "‰Ω†ÊòØ BeliveHome ÁöÑË£Ö‰øÆ‰∏éÈò≤Ê∞¥È°æÈóÆÔºåËØ¥ËØù‰∏ì‰∏ö‰ΩÜ‰∫≤Âàá„ÄÇÂõûÁ≠îÂ∞ΩÈáèÁÆÄÊ¥ÅÔºåÂøÖË¶ÅÊó∂ÁªôÊ≠•È™§ÊàñÊ∏ÖÂçï„ÄÇ"
  }
};

let lang = localStorage.getItem('bh_lang') || 'en';
const chatEl = document.getElementById('chat');
const qEl = document.getElementById('q');
const sendBtn = document.getElementById('send');
const langSel = document.getElementById('langSel');

langSel.value = lang;
applyLang();
appendBubble(STR[lang].hello, 'bot');

langSel.addEventListener('change', () => {
  lang = langSel.value;
  localStorage.setItem('bh_lang', lang);
  applyLang();
  appendBubble(STR[lang].hello, 'bot');
});
sendBtn.addEventListener('click', send);
qEl.addEventListener('keydown', e => { if (e.key === 'Enter') send(); });

function applyLang(){
  document.getElementById('title').textContent = STR[lang].title;
  document.getElementById('langLabel').textContent = STR[lang].language;
  qEl.placeholder = STR[lang].placeholder;
  sendBtn.textContent = STR[lang].send;
  document.getElementById('hint').textContent = STR[lang].hint;
}
function appendBubble(text, role){
  const div = document.createElement('div');
  div.className = 'bubble ' + (role === 'user' ? 'user' : 'bot');
  div.innerHTML = (text || '').replace(/\n/g,'<br>');
  chatEl.appendChild(div);
  chatEl.scrollTop = chatEl.scrollHeight;
  return div;
}
function showTyping(){
  const wrap = document.createElement('div');
  wrap.className = 'bubble bot';
  wrap.innerHTML = '<span class="typing"><span></span><span></span><span></span></span>';
  chatEl.appendChild(wrap);
  chatEl.scrollTop = chatEl.scrollHeight;
  return wrap;
}

async function send(){
  const text = qEl.value.trim();
  if (!text) return;
  qEl.value = '';
  appendBubble(text, 'user');
  const typing = showTyping();
  sendBtn.disabled = true;

  try {
    const r = await fetch(API_URL, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      // ‰∏∫‰∏çÊîπÂêéÁ´ØÔºåËøôÈáåÊää system prompt ÈôÑÂú® message ÂêéÔºõËã•Ë¶Å‰∏ä‰∏ãÊñáÂØπËØùÔºåÂèØÊâ©Â±ïÂêéÁ´Ø messages
      body: JSON.stringify({ message: `${text}\n\n(System Prompt: ${STR[lang].sysPrompt})` })
    });
    const data = await r.json();
    typing.remove();

    if (data.reply) {
      appendBubble(data.reply, 'bot');
    } else {
      const code = data?.details?.error?.code;
      if (code === 'insufficient_quota') {
        appendBubble(STR[lang].quota, 'bot');
      } else {
        appendBubble('‚ùå ' + (data?.error || JSON.stringify(data)), 'bot');
      }
    }
  } catch (e) {
    typing.remove();
    appendBubble(STR[lang].netErr(e.message), 'bot');
  } finally {
    sendBtn.disabled = false;
  }
}
</script>
</body>
</html>
